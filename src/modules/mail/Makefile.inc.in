# Makefile for TinyMUSH Mail
#
# Module source files
MOD_S += modules/mail/mail.c
MOD_I += modules/mail/mail.h
MOD_O += modules/mail/mail.o
MOD_LA += modules/mail/mail.la
MOD_DL += -dlopen ../game/modules/mail.la

modules/mail/mail.o: modules/mail/mail.c modules/mail/mail.h
	$(LIBTOOL) --mode=compile $(CC) $(ALLCFLAGS) -o $@ -c `echo $@ | sed -e 's/o$$/c/'`

modules/mail/mail.la: modules/mail/mail.o
	$(LIBTOOL) --mode=link $(CC) -module -o $@ `echo $@ | sed -e 's/a$$/o/'` -rpath `pwd`/../game/modules

install-modules: install-mail

install-mail: modules/mail/mail.la
	-mv ../game/modules/mail.* ../game/modules/libmail.* ../game/modules/old/
	$(LIBTOOL) --mode=install cp modules/mail/mail.la `pwd`/../game/modules/mail.la
	touch install-mail

clean: clean-mail

clean-mail:
	-rm -f modules/mail/*.o modules/mail/*.lo modules/mail/*.la
	-rm -rf modules/mail/.libs

distclean: distclean-mail

distclean-mail:
	-rm -f modules/mail/config.status modules/mail/config.log
	-rm -f install-mail ../game/modules/mail.* ../game/modules/libmail.* ../game/modules/old/mail.* ../game/modules/old/libmail.*
	-rm -f modules/mail/Makefile.inc
