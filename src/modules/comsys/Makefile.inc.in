# Makefile fragment for TinyMUSH ComSystem
#
# Module source files
MOD_S += modules/comsys/comsys.c
MOD_O += modules/comsys/comsys.o
MOD_LA += modules/comsys/comsys.la
MOD_DL += -dlopen ../game/modules/comsys.la

modules/comsys/comsys.o: modules/comsys/comsys.c
	$(LIBTOOL) --mode=compile $(CC) $(ALLCFLAGS) -o $@ -c `echo $@ | sed -e 's/o$$/c/'`

modules/comsys/comsys.la: modules/comsys/comsys.o
	$(LIBTOOL) --mode=link $(CC) -module -o $@ `echo $@ | sed -e 's/a$$/o/'` -rpath `pwd`/../game/modules

install-modules: install-comsys

install-comsys: modules/comsys/comsys.la
	-mv ../game/modules/comsys.* ../game/modules/libcomsys.* ../game/modules/old/
	$(LIBTOOL) --mode=install cp modules/comsys/comsys.la `pwd`/../game/modules/comsys.la
	touch install-comsys

clean: clean-comsys

clean-comsys:
	-rm -f modules/comsys/*.o modules/comsys/*.lo modules/comsys/*.la
	-rm -rf modules/comsys/.libs

distclean: distclean-comsys

distclean-comsys:
	-rm -f modules/comsys/config.status modules/comsys/config.log
	-rm -f install-comsys ../game/modules/comsys.* ../game/modules/libcomsys.* ../game/modules/old/comsys.* ../game/modules/old/libcomsys.*
	-rm -f modules/comsys/Makefile.inc
